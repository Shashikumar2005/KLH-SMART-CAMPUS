# 📊 Smart Campus KLH - System Architecture

## System Overview

```
┌─────────────────────────────────────────────────────────────┐
│                        SMART CAMPUS KLH                      │
│                    Full-Stack Application                    │
└─────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┴───────────────┐
              │                               │
        ┌─────▼─────┐                   ┌────▼────┐
        │  FRONTEND  │                   │ BACKEND │
        │ React+Vite │◄──────────────────┤ Node.js │
        │   MUI      │    REST API       │ Express │
        └────────────┘   Socket.IO       └─────────┘
```

## 🏗️ Architecture Diagram

```
┌──────────────────────────────────────────────────────────────────┐
│                         CLIENT LAYER                              │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌─────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Browser   │  │    Mobile    │  │    Tablet    │          │
│  │  (Chrome,   │  │   (Safari,   │  │   (iPad,     │          │
│  │  Firefox)   │  │   Chrome)    │  │   Android)   │          │
│  └──────┬──────┘  └──────┬───────┘  └──────┬───────┘          │
│         │                │                  │                    │
│         └────────────────┴──────────────────┘                    │
│                          │                                        │
└──────────────────────────┼────────────────────────────────────────┘
                           │
                  HTTP/HTTPS + WebSocket
                           │
┌──────────────────────────▼────────────────────────────────────────┐
│                    FRONTEND APPLICATION                            │
├───────────────────────────────────────────────────────────────────┤
│                                                                    │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │                    React Router v6                         │  │
│  │                   (Navigation & Routes)                     │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                    │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │                    Redux Toolkit Store                      │  │
│  │  ┌──────────┐ ┌───────────┐ ┌──────────┐ ┌─────────────┐ │  │
│  │  │   Auth   │ │  Events   │ │   Lost   │ │    Feed     │ │  │
│  │  │  Slice   │ │   Slice   │ │   Items  │ │    back     │ │  │
│  │  └──────────┘ └───────────┘ └──────────┘ └─────────────┘ │  │
│  │  ┌──────────┐ ┌───────────┐ ┌──────────┐ ┌─────────────┐ │  │
│  │  │Announce- │ │ Notifica- │ │ Chatbot  │ │             │ │  │
│  │  │  ments   │ │   tions   │ │  Slice   │ │             │ │  │
│  │  └──────────┘ └───────────┘ └──────────┘ └─────────────┘ │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                    │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │                     UI Components                           │  │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐      │  │
│  │  │    Pages     │ │  Components  │ │   Material   │      │  │
│  │  │  - Login     │ │  - Layout    │ │      UI      │      │  │
│  │  │  - Register  │ │  - Navbar    │ │  Components  │      │  │
│  │  │  - Dashboard │ │  - Sidebar   │ │              │      │  │
│  │  │  - Events    │ │  - Cards     │ │              │      │  │
│  │  │  - Lost&Found│ │  - Forms     │ │              │      │  │
│  │  └──────────────┘ └──────────────┘ └──────────────┘      │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                    │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │                      Services                               │  │
│  │  ┌──────────────┐         ┌──────────────┐                │  │
│  │  │  Axios API   │         │  Socket.IO   │                │  │
│  │  │    Client    │         │    Client    │                │  │
│  │  └──────────────┘         └──────────────┘                │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
                           │
                  REST API + WebSocket
                           │
┌──────────────────────────▼────────────────────────────────────────┐
│                     BACKEND APPLICATION                            │
├───────────────────────────────────────────────────────────────────┤
│                                                                    │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │                    Express.js Server                        │  │
│  │                  (HTTP + WebSocket)                         │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                    │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │                      Middleware                             │  │
│  │  ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────┐  │  │
│  │  │  CORS   │ │   Auth   │ │   Role   │ │    Error     │  │  │
│  │  │         │ │   JWT    │ │  Check   │ │   Handler    │  │  │
│  │  └─────────┘ └──────────┘ └──────────┘ └──────────────┘  │  │
│  │  ┌─────────┐ ┌──────────┐                                 │  │
│  │  │ Upload  │ │   Body   │                                 │  │
│  │  │ Multer  │ │  Parser  │                                 │  │
│  │  └─────────┘ └──────────┘                                 │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                    │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │                        Routes                               │  │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌────────────┐   │  │
│  │  │   Auth   │ │  Events  │ │   Lost   │ │  Feedback  │   │  │
│  │  │  /auth   │ │ /events  │ │  Items   │ │ /feedback  │   │  │
│  │  └──────────┘ └──────────┘ └──────────┘ └────────────┘   │  │
│  │  ┌──────────┐ ┌──────────┐                                │  │
│  │  │Announce- │ │ Chatbot  │                                │  │
│  │  │  ments   │ │/chatbot  │                                │  │
│  │  └──────────┘ └──────────┘                                │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                    │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │                     Controllers                             │  │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐      │  │
│  │  │     Auth     │ │    Events    │ │  Lost Items  │      │  │
│  │  │  Controller  │ │  Controller  │ │  Controller  │      │  │
│  │  └──────────────┘ └──────────────┘ └──────────────┘      │  │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐      │  │
│  │  │   Feedback   │ │Announcement  │ │   Chatbot    │      │  │
│  │  │  Controller  │ │  Controller  │ │  Controller  │      │  │
│  │  └──────────────┘ └──────────────┘ └──────────────┘      │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                    │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │                    Socket.IO Server                         │  │
│  │  ┌──────────────────────────────────────────────────────┐  │  │
│  │  │         Real-Time Event Broadcasting                  │  │  │
│  │  │  - New Events      - Lost Items                       │  │  │
│  │  │  - Announcements   - Feedback Updates                 │  │  │
│  │  │  - Notifications   - Status Changes                   │  │  │
│  │  └──────────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                    │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │                    Data Models                              │  │
│  │  ┌─────────┐ ┌─────────┐ ┌──────────┐ ┌─────────────┐    │  │
│  │  │  User   │ │  Event  │ │ LostItem │ │  Feedback   │    │  │
│  │  │  Model  │ │  Model  │ │  Model   │ │    Model    │    │  │
│  │  └─────────┘ └─────────┘ └──────────┘ └─────────────┘    │  │
│  │  ┌─────────────┐                                           │  │
│  │  │Announcement │                                           │  │
│  │  │    Model    │                                           │  │
│  │  └─────────────┘                                           │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
                           │
                ┌──────────┴──────────┐
                │                     │
┌───────────────▼──────┐  ┌──────────▼────────────┐
│   DATABASE LAYER     │  │  EXTERNAL SERVICES    │
├──────────────────────┤  ├───────────────────────┤
│                      │  │                       │
│  ┌────────────────┐ │  │  ┌─────────────────┐ │
│  │    MongoDB     │ │  │  │   Cloudinary    │ │
│  │     Atlas      │ │  │  │ (Image Storage) │ │
│  │                │ │  │  └─────────────────┘ │
│  │  - Users       │ │  │                       │
│  │  - Events      │ │  │  ┌─────────────────┐ │
│  │  - Lost Items  │ │  │  │  Google Gemini  │ │
│  │  - Feedback    │ │  │  │   AI API        │ │
│  │  - Announce... │ │  │  │  (Chatbot)      │ │
│  └────────────────┘ │  │  └─────────────────┘ │
│                      │  │                       │
└──────────────────────┘  │  ┌─────────────────┐ │
                          │  │   Gmail SMTP    │ │
                          │  │ (Email Notif.)  │ │
                          │  └─────────────────┘ │
                          │                       │
                          └───────────────────────┘
```

## 🔄 Data Flow

### 1. Authentication Flow
```
┌─────────┐      ┌──────────┐      ┌──────────┐      ┌──────────┐
│  User   │─────▶│ Frontend │─────▶│ Backend  │─────▶│ Database │
│ (Login) │      │  (Form)  │ POST │  (Auth)  │      │ (MongoDB)│
└─────────┘      └──────────┘ /auth└──────────┘      └──────────┘
                       │             │
                       │◀────────────┤ JWT Token
                       │             │
                 Store in Redux      │
                 & localStorage      │
                       │             │
                 ┌─────▼─────┐      │
                 │ Protected │      │
                 │  Routes   │      │
                 └───────────┘      │
```

### 2. Real-Time Update Flow
```
┌──────────┐                    ┌──────────┐
│ User A   │──── Create Event ─▶│ Backend  │
└──────────┘                    └─────┬────┘
                                      │
                         ┌────────────┴────────────┐
                         │                         │
                    Save to DB              Broadcast via
                         │                   Socket.IO
                    ┌────▼────┐                   │
                    │ MongoDB │              ┌────▼────┐
                    └─────────┘              │ All     │
                                            │ Connected│
                                            │ Users   │
                                            └─────────┘
                                                 │
                            ┌────────────────────┼────────────────────┐
                            │                    │                    │
                       ┌────▼────┐         ┌────▼────┐         ┌────▼────┐
                       │ User B  │         │ User C  │         │ User D  │
                       │(Student)│         │(Faculty)│         │ (Admin) │
                       └─────────┘         └─────────┘         └─────────┘
```

### 3. Chatbot Interaction Flow
```
┌─────────┐      ┌──────────┐      ┌──────────┐      ┌──────────────┐
│  User   │─────▶│ Chatbot  │─────▶│ Backend  │─────▶│    Gemini    │
│ (Query) │      │    UI    │ POST │  /chat   │      │   AI API     │
└─────────┘      └──────────┘      └──────────┘      └──────────────┘
                       │                  │                    │
                       │                  │◀───────────────────┤
                       │                  │   AI Response      
                       │◀─────────────────┤                    
                       │   JSON Response  │                    
                       │                  │                    
                 ┌─────▼─────┐            │                    
                 │  Display  │            │                    
                 │  Message  │            │                    
                 └───────────┘            │                    
```

## 🔐 Security Layers

```
┌─────────────────────────────────────────────────────────┐
│                    Security Stack                        │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  Layer 1: Network Security                              │
│  ┌──────────────────────────────────────────────────┐  │
│  │ - HTTPS/TLS Encryption                           │  │
│  │ - CORS Configuration                             │  │
│  │ - Rate Limiting                                  │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
│  Layer 2: Authentication                                │
│  ┌──────────────────────────────────────────────────┐  │
│  │ - JWT Tokens                                     │  │
│  │ - Password Hashing (bcrypt)                      │  │
│  │ - Session Management                             │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
│  Layer 3: Authorization                                 │
│  ┌──────────────────────────────────────────────────┐  │
│  │ - Role-Based Access Control (RBAC)               │  │
│  │ - Protected Routes                               │  │
│  │ - API Endpoint Guards                            │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
│  Layer 4: Input Validation                              │
│  ┌──────────────────────────────────────────────────┐  │
│  │ - Zod Schema Validation (Frontend)               │  │
│  │ - Express Validator (Backend)                    │  │
│  │ - SQL Injection Prevention                       │  │
│  │ - XSS Protection                                 │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
│  Layer 5: File Security                                 │
│  ┌──────────────────────────────────────────────────┐  │
│  │ - File Type Validation                           │  │
│  │ - File Size Limits                               │  │
│  │ - Cloudinary Secure Upload                       │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

## 📊 State Management Architecture

```
┌──────────────────────────────────────────────────────┐
│              Redux Toolkit Store                      │
├──────────────────────────────────────────────────────┤
│                                                       │
│  ┌────────────────────────────────────────────────┐ │
│  │           Auth Slice                           │ │
│  │  - user                                        │ │
│  │  - token                                       │ │
│  │  - isAuthenticated                             │ │
│  │  - login(), register(), logout()               │ │
│  └────────────────────────────────────────────────┘ │
│                                                       │
│  ┌────────────────────────────────────────────────┐ │
│  │          Events Slice                          │ │
│  │  - events[]                                    │ │
│  │  - currentEvent                                │ │
│  │  - fetchEvents(), createEvent()                │ │
│  └────────────────────────────────────────────────┘ │
│                                                       │
│  ┌────────────────────────────────────────────────┐ │
│  │        Lost Items Slice                        │ │
│  │  - items[]                                     │ │
│  │  - currentItem                                 │ │
│  │  - fetchItems(), createItem()                  │ │
│  └────────────────────────────────────────────────┘ │
│                                                       │
│  ┌────────────────────────────────────────────────┐ │
│  │         Feedback Slice                         │ │
│  │  - feedbackList[]                              │ │
│  │  - fetchFeedback(), createFeedback()           │ │
│  └────────────────────────────────────────────────┘ │
│                                                       │
│  ┌────────────────────────────────────────────────┐ │
│  │       Announcements Slice                      │ │
│  │  - announcements[]                             │ │
│  │  - fetchAnnouncements()                        │ │
│  └────────────────────────────────────────────────┘ │
│                                                       │
│  ┌────────────────────────────────────────────────┐ │
│  │       Notifications Slice                      │ │
│  │  - notifications[]                             │ │
│  │  - unreadCount                                 │ │
│  │  - addNotification(), markAsRead()             │ │
│  └────────────────────────────────────────────────┘ │
│                                                       │
│  ┌────────────────────────────────────────────────┐ │
│  │          Chatbot Slice                         │ │
│  │  - messages[]                                  │ │
│  │  - isOpen                                      │ │
│  │  - sendMessage(), toggleChatbot()              │ │
│  └────────────────────────────────────────────────┘ │
│                                                       │
└──────────────────────────────────────────────────────┘
```

## 🎨 Component Hierarchy

```
App
├── Router
│   ├── Public Routes
│   │   ├── Login
│   │   └── Register
│   │
│   └── Private Routes (Protected)
│       └── Layout
│           ├── AppBar
│           │   ├── Logo
│           │   ├── Navigation
│           │   ├── NotificationIcon
│           │   └── ProfileMenu
│           │
│           ├── Sidebar (Desktop)
│           │   └── Navigation Links
│           │
│           └── Main Content
│               ├── StudentDashboard
│               │   ├── Stats Cards
│               │   ├── Upcoming Events
│               │   └── Announcements
│               │
│               ├── FacultyDashboard
│               │   ├── Event Management
│               │   ├── Feedback Review
│               │   └── Analytics
│               │
│               ├── AdminDashboard
│               │   ├── User Management
│               │   ├── System Stats
│               │   └── Settings
│               │
│               ├── Events Page
│               │   ├── Event List
│               │   ├── Event Card
│               │   └── Create Event Form
│               │
│               ├── Lost & Found Page
│               │   ├── Item List
│               │   ├── Item Card
│               │   └── Report Item Form
│               │
│               └── Feedback Page
│                   ├── Feedback List
│                   └── Submit Feedback Form
│
└── Chatbot (Floating)
    ├── Chat Window
    │   ├── Header
    │   ├── Messages List
    │   └── Input Box
    └── FAB Button
```

---

**This architecture ensures:**
- ✅ Scalability
- ✅ Maintainability
- ✅ Security
- ✅ Performance
- ✅ Real-time capabilities
- ✅ Clean separation of concerns
